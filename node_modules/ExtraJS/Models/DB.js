const knex = require('knex');
const pluralize = require('pluralize')

class DB {
	load(id) {
		return new Promise((resolve, reject) => {
			db(pluralize(this.constructor.name.toUnderscoreCase())).where(this.primaryColumn, id).then((rows) => {
				if(rows.length === 1) {
					Object.keys(rows[0]).forEach((key) => {
						this[key] = rows[0][key];
					});
					resolve(true);
				} else {
					resolve(false);
				}
			});
		});
	}

	save() {
		return new Promise((resolve, reject) => {
			let temp = {};
			this.fillable.forEach((value) => {
				temp[value] = this[value];
			});
			db(pluralize(this.constructor.name.toUnderscoreCase())).insert(temp).then(function(id){
				resolve(id[0]);
			});
		});
	}
}

module.exports = DB;